<div class="concert-info-container container mt-4">
  <h2 class="text-center py-3 fw-bold">
    <i class="bi bi-calendar-event me-2"></i>最新演唱會資訊
  </h2>

  <!-- Initial Loading Spinner -->
  <div *ngIf="isLoading && allConcerts.length === 0" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">載入中...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ errorMessage }}
    <!-- Optional: Add a retry button for initial load failure -->
    <button *ngIf="!isLoading && allConcerts.length === 0 && !isLoadingMore" (click)="loadConcerts()" class="btn btn-sm btn-warning ms-3">重試</button>
  </div>

  <!-- Concert Data Display -->
  <div *ngIf="!isLoading && !errorMessage && allConcerts.length > 0">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <div *ngFor="let concert of allConcerts" class="col">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <div class="text-center">
              <h5 class="card-title">{{ concert.tit }}</h5>
              <h6 class="card-subtitle my-3 text-muted fw-bold">{{ concert.cit !== ' -' ? concert.cit : '未提供城市' }}</h6>
            </div>
            <ul class="list-unstyled flex-grow-1">
              <li>
                <strong><i class="bi bi-calendar-event"></i> 活動日期:</strong>
                <span class="truncate-list-item-value">{{ formatArrayDisplay(concert.pdt, '、') }}</span>
              </li>
              <li>
                <strong><i class="bi bi-ticket-perforated"></i> 售票時間:</strong>
                <span class="truncate-list-item-value">{{ formatArrayDisplay(concert.sdt, '、') }}</span>
              </li>
              <li>
                <strong><i class="bi bi-geo-alt"></i> 地點:</strong>
                <span class="truncate-list-item-value">{{ formatArrayDisplay(concert.loc, '、') }}</span>
              </li>
              <li>
                <strong><i class="bi bi-cash-coin"></i> 票價:</strong>
                <span class="truncate-list-item-value">{{ formatPriceDisplay(concert.prc) }}</span>
              </li>
              <!-- <li>
                <strong><i class="bi bi-clock"></i> API時間:</strong>
                <span class="truncate-list-item-value">{{ formatDate(concert.tim, 'yyyy/MM/dd HH:mm') }}</span>
              </li> -->
            </ul>

            <div class="mt-auto text-center">
              <a *ngIf="concert.url" [href]="concert.url" target="_blank" class="btn btn-primary btn-sm me-2">
                <i class="bi bi-link-45deg"></i> 活動/售票連結
              </a>
              <!-- <a *ngIf="concert.web" [href]="concert.web" target="_blank" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-globe"></i> 官方網站
              </a> -->
              <p *ngIf="!concert.url && !concert.web" class="text-muted small mt-2">無相關連結</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Page Info (Optional) -->
    <div class="mt-3 text-center" *ngIf="currentPage > 0 && totalPages > 0 && allConcerts.length > 0">
      <small>已顯示 {{ allConcerts.length }} 筆. (第 {{ currentPage }} / {{ totalPages }} 頁)</small>
    </div>
  </div>

  <!-- No Concerts Message -->
  <div *ngIf="!isLoading && !errorMessage && allConcerts.length === 0 && (currentPage > 0 || allDataLoaded)">
    <div class="alert alert-info" role="alert">
      目前沒有演唱會資訊可顯示。
    </div>
  </div>

  <!-- "Load More" Button Area -->
  <div *ngIf="!isLoading && !errorMessage && !allDataLoaded && allConcerts.length > 0" class="text-center mt-4 mb-2">
    <button (click)="loadConcerts(true)" class="btn btn-outline-primary btn-lg" [disabled]="isLoadingMore">
      <span *ngIf="isLoadingMore" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
      {{ isLoadingMore ? '載入中...' : '查看更多演唱會資訊' }}
    </button>
  </div>

  <!-- All Data Loaded Message -->
  <div *ngIf="!isLoading && !errorMessage && allDataLoaded && allConcerts.length > 0" class="alert alert-light text-center mt-4 mb-2" role="alert">
    已載入所有演唱會資訊。
  </div>

  <hr *ngIf="!isLoading && !errorMessage" class="my-4">
</div>
